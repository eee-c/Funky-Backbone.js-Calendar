h1= title

table#calendar
  thead
    tr
      th S
      th M
      th T
      th W
      th T
      th F
      th S
  tr#week0
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday
  tr#week1
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday
  tr#week2
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday
  tr#week3
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday
  tr#week4
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday
  tr#week5
    td.sunday
    td.monday
    td.tuesday
    td.wednesday
    td.thursday
    td.friday
    td.saturday

#dialog(title="Add calendar event")
  #calendar-event-start-date
  p title
  p
    input.title(type="text", name="title")
  p description
  p
    input.description(type="text", name="description")

script
  $(function() {
    $('#dialog').dialog({
      autoOpen: false,
      modal: true,
      buttons: [
        { text: "OK",
          class: "ok",
          click: function() { $(this).dialog("close"); } },
        { text: "Cancel",
          click: function() { $(this).dialog("close"); } }
      ]
    });
  });

script
  $(add_dates_to_calendar);

  function ISODateString(d) {
    function pad(n) {return n<10 ? '0'+n : n}
    return d.getFullYear()+'-'
      + pad(d.getMonth()+1)+'-'
      + pad(d.getDate())
  }

  function add_dates_to_calendar() {
    var today = new Date(),
        firstOfTheMonth = new Date(today.getFullYear(), today.getMonth(), 1),
        firstSunday = new Date(firstOfTheMonth.getTime() -
                               firstOfTheMonth.getDay()*24*60*60*1000);

    var date = firstSunday;
    _([0,1,2,3,4,5]).each(function(week) {
      var week_el = $('#week' + week),
          day_elements = week_el.find('td');

      _([0,1,2,3,4,5,6]).each(function(day) {
        var day_element = day_elements[day],
            other_month = (date.getMonth() != today.getMonth()),
            html = '<span class="day-of-month">' + date.getDate() + '</span>';

        $(day_element).
          html(html).
          attr('id', ISODateString(date)).
          addClass(other_month ? 'other-month' : '');

        date = new Date(date.getTime() + 24*60*60*1000);
      });
    });

    // remove whole week from next month
    var week5_other_month = _($('#week5').find('td')).all(function(el) {
      return $(el).hasClass('other-month')
    });
    if (week5_other_month) { $('#week5').hide() }
  }

script
  $(function() {
    window.Event = Backbone.Model.extend({
      urlRoot : '/events',
      initialize: function(attributes) { this.id = attributes['_id']; },
      destroy: function() {
        Backbone.Model.prototype.destroy.call(this, {
          headers: {'If-Match': this.get("_rev")}
        });
      }
    });

    window.EventList = Backbone.Collection.extend({
      model: Event,
      url: '/events',
      parse: function(response) {
        return _(response.rows).map(function(row) { return row.doc ;});
      }
    });

    window.Events = new EventList;

    window.EventView = Backbone.View.extend({
      template: _.template($('#calendar-event-template').html()),
      initialize: function(options) {
        options.model.bind('destroy', this.remove, this);
      },
      render: function() {
        $(this.el).append(this.template(this.model.toJSON()));
        return this;
      },
      events: {
        'click .delete': 'deleteClick'
      },
      deleteClick: function() {
        this.model.destroy();
      },
      remove: function() {
        $(this.el).find('.event').remove();
      }
    });

    Events.fetch({success: function(collection, response) {
        collection.each(function(event) {
          var el = $('#' + event.get("startDate")),
              view = new EventView({model: event, el: el});
          view.render();
        });
      }
    });


    window.AppView = Backbone.View.extend({
      el: $("#dialog").parent(),
      events: {
        'click .ok':  'create'
      },
      create: function() {
        Events.create({
          title: this.el.find('input.title').val(),
          description: this.el.find('input.description').val(),
          startDate: "2011-09-01"});
      }
    });

    window.AppView = new AppView;
  });

|<script type="text/template" id="calendar-event-template">
|  <span class="event" title="<%= description %>">
|      <%= title %>
|      <span class="delete">X</span>
|  </span>
|</script>

